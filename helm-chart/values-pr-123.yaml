# Values file for preview environments (PR-based deployments)
# This file is optimized for GKE preview environments with wildcard DNS

# Disable shared ingress (handled by nginx ingress instead)
sharedIngress:
  enabled: false

# Image configuration
projectId: eaas-486821
image:
  repository: us-central1-docker.pkg.dev 
  name: docker-repo/helloworld 
  tag: "latest" #Change this to use PR number and commit SHA when deployer script is implemented, e.g., "pr-123-abc123"
  pullPolicy: IfNotPresent

# Service configuration
service:
  type: ClusterIP
  port: 8080
  # No controller-specific annotations needed; nginx uses standard Ingress resources
  annotations: {}

# Ingress configuration - REQUIRED for nginx ingress controller
# nginx ingress controller watches standard Ingress resources
ingress:
  enabled: true
  className: "nginx"  # Use nginx ingress class so nginx picks up this ingress
  annotations: {}
  hosts:
    - host: <your-preview-hostname>  # Update with preview hostname <e.g. preview-pr-123.pre.chaoticbee.com
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Resource limits
resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Single replica for preview
replicaCount: 1

# Environment variables
env:
  - name: PR_NUMBER
    value: "123"  # Update with actual PR number
  - name: COMMIT_SHA
    value: "abc123"  # Update with actual commit SHA

# Health checks
livenessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Service account
serviceAccount:
  create: true
  automount: true
